version: 1

tasks:
  - name: tidb-cyclo
    taskType: cyclo
    shellScript: |
      gocyclo -over 20 -avg ./ || true

  - name: tidb-gosec
    taskType: gosec
    shellScript: |
      gosec -fmt=junit-xml -out=results.xml -stdout -verbose=text -exclude=G103,G104,G204,G307,G401,G404,G501,G505,G601 ./... || true
    reportDir: results.xml

  - name: tidb-check-license
    taskType: common
    shellScript: |
      mkdir -p tools/bin
      curl  ${FILE_SERVER_URL}/download/cicd/tools/license-eye-latest-ed749b8-linux-amd64 > tools/bin/license-eye
      chmod +x tools/bin/license-eye
      ./tools/bin/license-eye -c .github/licenserc.yml -v info header check
    buildEnv:
      image: hub.pingcap.net/pingcap/centos7_golang-1.16:latest